# AWS AI AGENT SETUP CHECKLIST

## CURRENT STATUS: Setting up IAM permissions (In Progress)

## PART 1: AWS INFRASTRUCTURE SETUP

### 1.1 Create IAM Role and Permissions
- [x] Navigate to IAM in AWS Console
- [x] Create IAM role for Lambda (ai-agent-lambda-role)
- [ ] Add comprehensive permissions:
  - [ ] S3 Permissions:
    - [ ] s3:GetObject - Read documents from S3
    - [ ] s3:PutObject - Create or update documents
    - [ ] s3:DeleteObject - Delete documents when needed
    - [ ] s3:ListBucket - List documents in bucket
    - [ ] s3:GetObjectVersion - Access versioned documents
    - [ ] s3:PutObjectAcl - Modify access controls
    - [ ] s3:GetObjectTagging - Read document tags
    - [ ] s3:PutObjectTagging - Apply tags to documents
  - [ ] DynamoDB Permissions:
    - [ ] dynamodb:GetItem - Retrieve document metadata
    - [ ] dynamodb:PutItem - Create new metadata entries
    - [ ] dynamodb:UpdateItem - Update existing metadata
    - [ ] dynamodb:DeleteItem - Remove metadata when needed
    - [ ] dynamodb:Query - Search for documents
    - [ ] dynamodb:Scan - List documents
    - [ ] dynamodb:BatchWriteItem - Batch operations
  - [ ] CloudWatch Permissions:
    - [ ] logs:CreateLogGroup - Create log groups
    - [ ] logs:CreateLogStream - Create log streams
    - [ ] logs:PutLogEvents - Write logs
    - [ ] logs:DescribeLogStreams - Read logs
  - [ ] SQS Permissions:
    - [ ] sqs:SendMessage - Queue document processing tasks
    - [ ] sqs:ReceiveMessage - Get tasks from queue
    - [ ] sqs:DeleteMessage - Remove completed tasks
  - [ ] Lambda Permissions:
    - [ ] lambda:InvokeFunction - Call other Lambda functions
  - [ ] KMS Permissions:
    - [ ] kms:Decrypt - Decrypt sensitive data
    - [ ] kms:GenerateDataKey - Generate keys for encryption
  - [ ] CloudFront Permissions:
    - [ ] cloudfront:CreateInvalidation - Invalidate cached content

### 1.2 Create DynamoDB Tables
- [ ] Navigate to DynamoDB in AWS Console
- [ ] Create "Documents" table (Primary key: id)
- [ ] Create "Collections" table (Primary key: id)
- [ ] Create "DocumentCollections" table (Partition key: documentId, Sort key: collectionId)

### 1.3 Create Lambda Function
- [ ] Navigate to Lambda in AWS Console
- [ ] Create new function "openai-agent-function"
- [ ] Select Python 3.9 (or latest) runtime
- [ ] Select the IAM role created in step 1.1
- [ ] Configure function settings:
  - [ ] Memory: 512 MB (or higher)
  - [ ] Timeout: 60 seconds (or higher)

### 1.4 Configure Lambda Environment Variables
- [ ] Add OPENAI_API_KEY
- [ ] Add S3_BUCKET_NAME
- [ ] Add CORS_ALLOWED_ORIGINS (Vercel app URL)
- [ ] Add JWT_SECRET (if using JWT)

### 1.5 Create Lambda Deployment Package
- [ ] Create new directory for Lambda code
- [ ] Set up Python virtual environment
- [ ] Install required dependencies:
  - [ ] openai
  - [ ] boto3
  - [ ] requests
  - [ ] python-jose (for JWT)
- [ ] Create lambda_function.py with AI agent code
- [ ] Create requirements.txt file
- [ ] Build deployment package
- [ ] Upload deployment package to Lambda

### 1.6 Create API Gateway
- [ ] Navigate to API Gateway in AWS Console
- [ ] Create REST API "ai-agent-api"
- [ ] Create /agent resource
- [ ] Add POST method to /agent
- [ ] Configure Lambda integration
- [ ] Configure CORS for the API
  - [ ] Allow-Origin: Vercel app URL
  - [ ] Allow-Headers: Content-Type,Authorization
  - [ ] Allow-Methods: OPTIONS,POST
- [ ] Deploy API to "prod" stage
- [ ] Note Invoke URL for Vercel integration

## PART 2: VERCEL INTEGRATION

### 2.1 Configure Vercel Environment Variables
- [ ] Add NEXT_PUBLIC_AI_AGENT_ENDPOINT to Vercel
- [ ] Add JWT_SECRET (if using JWT)

### 2.2 Create Next.js API Routes
- [ ] Create api/ai-agent.ts API route
- [ ] Implement error handling and retries
- [ ] Add JWT authentication (if using)

### 2.3 Create React Components
- [ ] Create AIAgent.tsx component
- [ ] Implement prompt input and response display
- [ ] Add loading state and error handling
- [ ] Create document context awareness

### 2.4 Integrate with Document Pages
- [ ] Add AI Agent to document viewing pages
- [ ] Pass document key to AI agent
- [ ] Test integration with actual documents

### 2.5 Deploy Vercel App
- [ ] Commit changes to GitHub
- [ ] Deploy to Vercel
- [ ] Verify deployment success

## PART 3: SECURITY ENHANCEMENTS

### 3.1 Implement JWT Authentication
- [ ] Generate JWT secret
- [ ] Update Lambda to validate JWT
- [ ] Update Next.js to send JWT
- [ ] Test authentication flow

### 3.2 Add Rate Limiting
- [ ] Configure API Gateway usage plans
- [ ] Add rate limiting to prevent abuse
- [ ] Test rate limiting

### 3.3 Implement Security Best Practices
- [ ] Validate inputs on both client and server
- [ ] Sanitize document content
- [ ] Implement proper error handling
- [ ] Add logging for security events

## PART 4: TESTING

### 4.1 Test End-to-End Integration
- [ ] Test document upload to S3
- [ ] Test AI agent with various documents
- [ ] Verify correct responses
- [ ] Check error handling

### 4.2 Load Testing
- [ ] Test with multiple concurrent users
- [ ] Verify Lambda scaling
- [ ] Check for performance bottlenecks

## PART 5: MONITORING AND OPTIMIZATION

### 5.1 Set Up Monitoring
- [ ] Create CloudWatch dashboards
- [ ] Set up alarms for errors
- [ ] Configure notification for issues
- [ ] Monitor Lambda duration and memory usage

### 5.2 Optimize Performance
- [ ] Analyze Lambda cold start impact
- [ ] Consider provisioned concurrency
- [ ] Implement caching where appropriate
- [ ] Optimize memory allocation

### 5.3 Cost Management
- [ ] Set up AWS Budgets
- [ ] Monitor Lambda usage
- [ ] Configure budget alerts
- [ ] Optimize for cost efficiency

## NOTES

- Replace placeholder values with actual resource names/IDs
- Test after completing each major section
- Document credentials securely (not in code)
- Consider using AWS Parameter Store for sensitive values
- Review IAM permissions regularly and apply least privilege

## CUSTOM IAM POLICY TEMPLATE
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket",
                "s3:GetObjectVersion",
                "s3:PutObjectAcl",
                "s3:GetObjectTagging",
                "s3:PutObjectTagging"
            ],
            "Resource": [
                "arn:aws:s3:::YOUR-BUCKET-NAME",
                "arn:aws:s3:::YOUR-BUCKET-NAME/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:BatchWriteItem"
            ],
            "Resource": [
                "arn:aws:dynamodb:*:*:table/YOUR-TABLE-NAME"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams"
            ],
            "Resource": "arn:aws:logs:*:*:*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "sqs:SendMessage",
                "sqs:ReceiveMessage",
                "sqs:DeleteMessage"
            ],
            "Resource": "arn:aws:sqs:*:*:YOUR-QUEUE-NAME"
        },
        {
            "Effect": "Allow",
            "Action": [
                "lambda:InvokeFunction"
            ],
            "Resource": "arn:aws:lambda:*:*:function:*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt",
                "kms:GenerateDataKey"
            ],
            "Resource": "arn:aws:kms:*:*:key/YOUR-KMS-KEY-ID"
        },
        {
            "Effect": "Allow",
            "Action": [
                "cloudfront:CreateInvalidation"
            ],
            "Resource": "arn:aws:cloudfront::*:distribution/YOUR-DISTRIBUTION-ID"
        }
    ]
}
``` 