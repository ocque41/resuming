# AWS MANUAL CONFIGURATION PLAN
# ========================
# This document provides step-by-step instructions for manually configuring AWS services
# to support the AI document agent implementation.

## 1. AWS ACCOUNT SETUP (if not already done)
   1.1. Create AWS account if not already available
   1.2. Enable MFA for root account for additional security
   1.3. Create an IAM user with administrative access for daily operations
   1.4. Download AWS CLI and configure with `aws configure` command
   1.5. Set up AWS region to one close to your target users

## 2. S3 BUCKET CREATION AND CONFIGURATION
   2.1. Log in to AWS Management Console
   2.2. Navigate to S3 service
   2.3. Click "Create bucket"
   2.4. Enter unique bucket name (e.g., "your-app-documents")
   2.5. Select appropriate region (same as Lambda region for performance)
   2.6. Set appropriate access settings (recommended: Block all public access)
   2.7. Enable versioning if document history is needed
   2.8. Add tags for resource management (optional)
   2.9. Set up encryption (recommended: SSE-S3 or SSE-KMS)
   2.10. Create bucket with selected settings
   2.11. Configure CORS settings:
      a. Go to bucket → Permissions → CORS
      b. Add the following configuration (customize allowed origins):
```json
[
    {
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["PUT", "POST", "GET", "HEAD"],
        "AllowedOrigins": ["https://your-vercel-app-domain.com"],
        "ExposeHeaders": ["ETag"]
    }
]
```
   2.12. Set up lifecycle rules if needed (optional):
      a. Go to bucket → Management → Lifecycle
      b. Create rule for temporary file cleanup
      c. Set expiration rules for incomplete multipart uploads

## 3. IAM ROLE CREATION FOR LAMBDA
   3.1. Navigate to IAM service in AWS Console
   3.2. Go to Roles → Create role
   3.3. Select AWS Lambda as the service that will use the role
   3.4. Add permissions policies:
      a. AWSLambdaBasicExecutionRole (for CloudWatch Logs)
      b. Create custom policy from aws_policies.json template
   3.5. Update policy template with your specific resource names:
      a. Replace "YOUR-BUCKET-NAME" with your actual S3 bucket name
      b. Replace DynamoDB table ARNs if using different table names
      c. Update KMS key ID if using KMS encryption
   3.6. Name your role (e.g., "AI-Document-Agent-Lambda-Role")
   3.7. Add description and tags
   3.8. Review and create the role
   3.9. Note the Role ARN for Lambda function creation

## 4. LAMBDA FUNCTION CREATION: MAIN AI AGENT
   4.1. Navigate to Lambda service in AWS Console
   4.2. Click "Create function"
   4.3. Choose "Author from scratch"
   4.4. Enter function name (e.g., "ai-document-agent")
   4.5. Select runtime: Python 3.9 or newer
   4.6. Change default execution role → Use existing role
   4.7. Select the role created in step 3
   4.8. Advanced settings:
      a. Enable function URL (if direct access needed)
      b. Configure VPC if needed for security
      c. Set memory allocation (recommended: 256-512MB)
      d. Set timeout (recommended: 30 seconds)
   4.9. Create function
   4.10. Upload deployment package:
      a. Code tab → Upload from → .zip file
      b. Upload lambda_deployment_package.zip
      c. Click "Save"
   4.11. Set environment variables:
      a. Configuration tab → Environment variables → Edit
      b. Add the following variables:
         - OPENAI_API_KEY: your-api-key
         - S3_BUCKET: your-bucket-name
         - DOCUMENTS_TABLE: documents (or your custom name)
         - COLLECTIONS_TABLE: collections (or your custom name)
         - DOC_COLLECTIONS_TABLE: documentCollections (or your custom name)
      c. Save changes
   4.12. Verify handler configuration:
      a. Runtime settings → Edit
      b. Ensure handler is set to "lambda_function.lambda_handler"
      c. Save

## 5. LAMBDA FUNCTION CREATION: PRESIGNED URL GENERATOR
   5.1. Repeat steps 4.1-4.9 with different function name (e.g., "presigned-url-generator")
   5.2. Upload a deployment package with presigned_url_generator.py as main file
   5.3. Set environment variables:
      a. S3_BUCKET: your-bucket-name
      b. UPLOAD_PREFIX: pdfs/
   5.4. Verify handler configuration: set to "presigned_url_generator.lambda_handler"

## 6. API GATEWAY SETUP FOR MAIN AI AGENT
   6.1. Navigate to API Gateway in AWS Console
   6.2. Click "Create API" → REST API → Build
   6.3. Enter API name (e.g., "ai-document-agent-api")
   6.4. Create API
   6.5. Create resource:
      a. Click "Actions" → "Create Resource"
      b. Resource name: "agent"
      c. Enable CORS if needed
      d. Create resource
   6.6. Create method:
      a. With resource selected, click "Actions" → "Create Method"
      b. Select POST
      c. Integration type: Lambda Function
      d. Lambda function: select your AI agent function
      e. Save
   6.7. Configure CORS for the resource:
      a. Select resource → "Actions" → "Enable CORS"
      b. For Access-Control-Allow-Origin, enter your Vercel app domain
      c. Enable appropriate headers and methods
      d. Save
   6.8. Deploy API:
      a. Click "Actions" → "Deploy API"
      b. Create new stage: "prod"
      c. Deploy
   6.9. Note the Invoke URL shown after deployment - this is your API endpoint

## 7. API GATEWAY SETUP FOR PRESIGNED URL GENERATOR
   7.1. Repeat steps 6.1-6.9 with a new resource name (e.g., "upload-url")
   7.2. Set the Lambda integration to point to your presigned URL generator function
   7.3. Note the Invoke URL - this is your presigned URL API endpoint

## 8. DYNAMODB TABLES (IF NEEDED)
   8.1. Navigate to DynamoDB in AWS Console
   8.2. Create "documents" table:
      a. Table name: documents
      b. Partition key: dc (string)
      c. Configure settings (on-demand capacity recommended for start)
      d. Create table
   8.3. Create "collections" table:
      a. Table name: collections
      b. Partition key: ct (string)
      c. Configure settings
      d. Create table
   8.4. Create "documentCollections" table:
      a. Table name: documentCollections
      b. Partition key: dc (string)
      c. Sort key: ct (string)
      d. Configure settings
      e. Create table

## 9. CLOUDWATCH MONITORING SETUP
   9.1. Navigate to CloudWatch in AWS Console
   9.2. Create Lambda function log group monitoring:
      a. Go to "Logs" → "Log groups"
      b. Find log groups for your Lambda functions (/aws/lambda/function-name)
   9.3. Create CloudWatch Alarms:
      a. Alarms → "Create alarm"
      b. Select Lambda metrics → Per-function metrics
      c. Choose your Lambda function
      d. Select metrics like Errors, Duration, Invocations
      e. Set appropriate thresholds
      f. Configure notifications
      g. Create alarm

## 10. VERCEL ENVIRONMENT VARIABLE SETUP
   10.1. Log in to Vercel dashboard
   10.2. Select your project
   10.3. Go to Settings → Environment Variables
   10.4. Add the following variables:
      a. AWS_LAMBDA_AI_AGENT_ENDPOINT: https://your-api-gateway-url/prod/agent
      b. AWS_LAMBDA_PRESIGNED_URL_ENDPOINT: https://your-api-gateway-url/prod/upload-url
   10.5. Set variables to be available in Production, Preview, and Development
   10.6. Save and deploy

## 11. TESTING THE CONFIGURATION
   11.1. Test S3 access:
      a. Try uploading a file directly in S3 console
      b. Verify access with AWS CLI: `aws s3 ls s3://your-bucket-name`
   11.2. Test Lambda functions directly:
      a. Create test events in Lambda console
      b. Run test for each function
      c. Verify CloudWatch logs for execution results
   11.3. Test API Gateway endpoints:
      a. Use Postman or curl to send requests to endpoints
      b. Verify responses are as expected
   11.4. End-to-end testing:
      a. Deploy Vercel app with environment variables
      b. Test file upload functionality
      c. Test AI agent interaction

## 12. SECURITY REVIEW
   12.1. Review IAM permissions for principle of least privilege
   12.2. Check S3 bucket policy for any public access
   12.3. Verify API Gateway has proper authorization
   12.4. Ensure sensitive environment variables are properly secured
   12.5. Check CloudTrail for any unauthorized access attempts
   12.6. Enable AWS Config for compliance monitoring (optional)

## 13. PERFORMANCE OPTIMIZATION
   13.1. Review Lambda function performance metrics
   13.2. Adjust memory allocation if needed
   13.3. Consider enabling Lambda provisioned concurrency for consistent performance
   13.4. Set up S3 transfer acceleration if dealing with large files
   13.5. Consider CloudFront distribution for global performance

## 14. COST MONITORING
   14.1. Set up AWS Budgets to monitor costs
   14.2. Create cost alarms for unexpected spending
   14.3. Review Cost Explorer regularly
   14.4. Optimize resource usage based on actual traffic patterns

## 15. MAINTENANCE PLAN
   15.1. Schedule regular reviews of AWS resource configuration
   15.2. Plan for dependency updates (e.g., OpenAI client library)
   15.3. Set up automated backups for DynamoDB tables
   15.4. Create runbook for common operational tasks
   15.5. Document troubleshooting procedures 